package purdue.edu.bicker_quicker;

import android.app.Activity;
import android.content.Intent;
import android.os.Bundle;
import android.support.annotation.NonNull;
import android.support.design.widget.FloatingActionButton;
import android.support.design.widget.Snackbar;
import android.support.v7.app.AppCompatActivity;
import android.support.v7.widget.Toolbar;
import android.view.MotionEvent;
import android.view.View;
import android.view.ViewGroup;
import android.view.inputmethod.InputMethodManager;
import android.widget.Button;
import android.widget.EditText;
import android.widget.Toast;

import com.google.firebase.database.*;
import com.google.firebase.database.FirebaseDatabase;
import com.firebase.ui.auth.AuthUI;
import com.google.android.gms.tasks.OnCompleteListener;
import com.google.android.gms.tasks.Task;

public class ViewBicker extends AppCompatActivity {
    Button leftVote;
    Button rightVote;
    Button noVote;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        FirebaseDatabase database = FirebaseDatabase.getInstance();
        DatabaseReference ref = database.getReference("Bicker");
        setContentView(R.layout.view_bicker); //add view_bicker to R.layout?
        leftVote = findViewById(R.id.left);
        rightVote = findViewById(R.id.right);
        noVote = findViewById(R.id.abstain);
        Button exit = findViewById(R.id.exit);

        //set listeners for voting buttons
        leftVote.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                vote(1);
            }
        });
        rightVote.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                vote(2);
            }
        });
        noVote.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                viewVotes();
            }
        });
    }

    //method to update the vote count for left (1) or right (2)
    public void vote(int response) {
        FirebaseDatabase database = FirebaseDatabase.getInstance();
        DatabaseReference ref = response == 1 ? database.getReference("Bicker").child("left_votes") :
                database.getReference("Bicker").child("right_votes");

        ref.addListenerForSingleValueEvent(new ValueEventListener() {
            @Override
            public void onDataChange(DataSnapshot dataSnapshot) {
                long value = (long) dataSnapshot.getValue();
                value = value++;
                dataSnapshot.getRef().setValue(value);
            }
            @Override
            public void onCancelled(DatabaseError e) {

            }
        });
        //update User db w/ this bicker's id
        viewVotes();
    }

    public void viewVotes() {
        //disable voting buttons, show results
        leftVote.setEnabled(false);
        rightVote.setEnabled(false);
        noVote.setEnabled(false);


    }
}